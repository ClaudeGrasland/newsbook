<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Data collection | The R News Book</title>
  <meta name="description" content="This is a summary of experience and methods developped for the analysis of news flow." />
  <meta name="generator" content="bookdown 0.20 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Data collection | The R News Book" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="This is a summary of experience and methods developped for the analysis of news flow." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Data collection | The R News Book" />
  
  <meta name="twitter:description" content="This is a summary of experience and methods developped for the analysis of news flow." />
  

<meta name="author" content="Claude Grasland, Romain Leconte, Hugues Pecout, Etienne Toureille, …" />


<meta name="date" content="2020-07-09" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="intro.html"/>
<link rel="next" href="data-check.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script>


<style type="text/css">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">My Book</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Objectives</a></li>
<li class="chapter" data-level="2" data-path="intro.html"><a href="intro.html"><i class="fa fa-check"></i><b>2</b> Introduction</a></li>
<li class="chapter" data-level="3" data-path="data-collect.html"><a href="data-collect.html"><i class="fa fa-check"></i><b>3</b> Data collection</a><ul>
<li class="chapter" data-level="3.1" data-path="data-collect.html"><a href="data-collect.html#data-level-1-title-of-news"><i class="fa fa-check"></i><b>3.1</b> DATA LEVEL 1 : Title of news</a><ul>
<li class="chapter" data-level="3.1.1" data-path="data-collect.html"><a href="data-collect.html#download-titles-with-mediacloud-interface"><i class="fa fa-check"></i><b>3.1.1</b> Download titles with mediacloud interface</a></li>
<li class="chapter" data-level="3.1.2" data-path="data-collect.html"><a href="data-collect.html#transformation-and-storage-in-quanteda-format."><i class="fa fa-check"></i><b>3.1.2</b> Transformation and storage in quanteda format.</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="data-collect.html"><a href="data-collect.html#data-level-2-title-of-news-description"><i class="fa fa-check"></i><b>3.2</b> DATA LEVEL 2 : Title of news + description</a><ul>
<li class="chapter" data-level="3.2.1" data-path="data-collect.html"><a href="data-collect.html#cleaning-the-html-code-in-description-file"><i class="fa fa-check"></i><b>3.2.1</b> Cleaning the html code in description file</a></li>
<li class="chapter" data-level="3.2.2" data-path="data-collect.html"><a href="data-collect.html#transformation-of-textdescription-in-quanteda-corpus"><i class="fa fa-check"></i><b>3.2.2</b> Transformation of text+description in quanteda corpus</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="data-collect.html"><a href="data-collect.html#data-level-3-full-text"><i class="fa fa-check"></i><b>3.3</b> DATA LEVEL 3 : Full text</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="data-check.html"><a href="data-check.html"><i class="fa fa-check"></i><b>4</b> Data Check and Clean</a><ul>
<li class="chapter" data-level="4.1" data-path="data-check.html"><a href="data-check.html#prerequites-quanteda-or-tidytext"><i class="fa fa-check"></i><b>4.1</b> Prerequites : quanteda (or tidytext)</a></li>
<li class="chapter" data-level="4.2" data-path="data-check.html"><a href="data-check.html#check-1-length-of-texts"><i class="fa fa-check"></i><b>4.2</b> CHECK 1 : length of texts</a><ul>
<li class="chapter" data-level="4.2.1" data-path="data-check.html"><a href="data-check.html#number-of-sentences"><i class="fa fa-check"></i><b>4.2.1</b> Number of sentences</a></li>
<li class="chapter" data-level="4.2.2" data-path="data-check.html"><a href="data-check.html#number-of-tokens"><i class="fa fa-check"></i><b>4.2.2</b> Number of tokens</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="data-check.html"><a href="data-check.html#check-2-time-distribution"><i class="fa fa-check"></i><b>4.3</b> CHECK 2 : Time distribution</a><ul>
<li class="chapter" data-level="4.3.1" data-path="data-check.html"><a href="data-check.html#news-without-date"><i class="fa fa-check"></i><b>4.3.1</b> News without date</a></li>
<li class="chapter" data-level="4.3.2" data-path="data-check.html"><a href="data-check.html#distribution-of-news-through-time"><i class="fa fa-check"></i><b>4.3.2</b> Distribution of news through time</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="data-check.html"><a href="data-check.html#check-3-suspect-words"><i class="fa fa-check"></i><b>4.4</b> CHECK 3 : Suspect words</a><ul>
<li class="chapter" data-level="4.4.1" data-path="data-check.html"><a href="data-check.html#tips-1-simple-word-fequencies"><i class="fa fa-check"></i><b>4.4.1</b> Tips 1 : simple word fequencies</a></li>
<li class="chapter" data-level="4.4.2" data-path="data-check.html"><a href="data-check.html#tips-2-most-frequent-n-grams"><i class="fa fa-check"></i><b>4.4.2</b> Tips 2 : most frequent n-grams</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="data-check.html"><a href="data-check.html#check-4-human-expertise"><i class="fa fa-check"></i><b>4.5</b> CHECK 4 : Human expertise</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/ClaudeGrasland/newsbook" target="blank"></a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The R News Book</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data_collect" class="section level1">
<h1><span class="header-section-number">Chapter 3</span> Data collection</h1>
<p>We can have different use of data, depending on the amount of text available. Basically, we will distingush between three cases corresponding to three levels of information :</p>
<ul>
<li><strong>title of news</strong> : typically, the case of data downloaded on mediacloud</li>
<li><strong>title of news</strong> + description : typically the case of data obtained by webscrapping of RSS flows and parsing of the XML code.</li>
<li>**full text of *news** : typically the data obtained through a private provider of newspapers (Factiva, EuroPresse, LexisNexis …) of by (non legal) scrapping of text through the URL’s.</li>
</ul>
<div id="data-level-1-title-of-news" class="section level2">
<h2><span class="header-section-number">3.1</span> DATA LEVEL 1 : Title of news</h2>
<div id="download-titles-with-mediacloud-interface" class="section level3">
<h3><span class="header-section-number">3.1.1</span> Download titles with mediacloud interface</h3>
<p>We suppose that you want to analyze the title of the news collected by the New York Times during the first semester of 2020. You can easily proceed to such a collection with the application Mediacloud.</p>
<p><a href="https://explorer.mediacloud.org" class="uri">https://explorer.mediacloud.org</a></p>
<p>You need firstly to register (for free) in order to create an account. Then you can select your media, select your period and select all stories by using the request ’*’ as in the example presented below.</p>
<p><img src="pics/mc001.png" /><!-- --></p>
<p>Below your request, you obtain a graphic entitled <em>Attention Over Time</em> with the distribution of the number of news published per day which help you to verify if the distribution of news is regular through time. In our example, you an notice a classical week cycle (with decrease of the number of news publish during the week-end). But you can also observe a discontinuity at the beginning of May 2020 with a decline to a lower level of production of news.</p>
<p><img src="pics/mc002.png" /><!-- -->
Going down, you will find a news panel entitled <em>Total Attention</em> which gives you the total number of stories found. In our example, we have a total of 47522 stories produced by the NYT during the first semester of 2020.</p>
<p><img src="pics/mc003.png" /><!-- --></p>
<p>Finally, by clicking on the button <em>Download all story URLS</em>, you can get a .csv file that you can easily load in your favorite porgramming language. In the case of R, you can load it with a program like this.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-collect.html#cb1-1"></a>df&lt;-<span class="kw">read.csv</span>(<span class="dt">file =</span> <span class="st">&quot;_data/mc/en_USA_nytime_20200101_20200630.csv&quot;</span>,</span>
<span id="cb1-2"><a href="data-collect.html#cb1-2"></a>             <span class="dt">sep=</span><span class="st">&quot;,&quot;</span>,</span>
<span id="cb1-3"><a href="data-collect.html#cb1-3"></a>             <span class="dt">header=</span>T,</span>
<span id="cb1-4"><a href="data-collect.html#cb1-4"></a>             <span class="dt">encoding =</span> <span class="st">&quot;UTF-8&quot;</span>,</span>
<span id="cb1-5"><a href="data-collect.html#cb1-5"></a>             <span class="dt">stringsAsFactors =</span> F)</span>
<span id="cb1-6"><a href="data-collect.html#cb1-6"></a><span class="kw">str</span>(df)</span></code></pre></div>
<pre><code>## &#39;data.frame&#39;:	30265 obs. of  10 variables:
##  $ stories_id   : int  1483747633 1483747632 1483779604 1483817555 1483817553 1483858519 1483858517 1483858514 1483858512 1483858499 ...
##  $ publish_date : chr  &quot;2020-01-01 00:00:08&quot; &quot;2020-01-01 00:05:07&quot; &quot;2020-01-01 01:00:05&quot; &quot;2020-01-01 03:00:11&quot; ...
##  $ title        : chr  &quot;Meteor Showers in 2020 That Will Light Up Night Skies&quot; &quot;Rocket Launches, Trips to Mars and More 2020 Space and Astronomy Events&quot; &quot;What’s on TV Wednesday: A Linda Ronstadt Doc and ‘Doctor Who’&quot; &quot;Why Did the U.S. Become the Focus of Iraqis’ Anger?&quot; ...
##  $ url          : chr  &quot;https://www.nytimes.com/2020/01/01/science/meteor-showers-2020.html&quot; &quot;https://www.nytimes.com/2020/01/01/science/space-astronomy-2020.html&quot; &quot;https://www.nytimes.com/2020/01/01/arts/television/whats-on-tv-wednesday-a-linda-ronstadt-doc-and-doctor-who.html&quot; &quot;https://www.nytimes.com/2020/01/01/world/middleeast/iraq-embassy-iran.html&quot; ...
##  $ language     : chr  &quot;en&quot; &quot;en&quot; &quot;en&quot; &quot;en&quot; ...
##  $ ap_syndicated: chr  &quot;False&quot; &quot;False&quot; &quot;False&quot; &quot;False&quot; ...
##  $ themes       : chr  &quot;&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ media_id     : int  1 1 1 1 1 1 1 1 1 1 ...
##  $ media_name   : chr  &quot;New York Times&quot; &quot;New York Times&quot; &quot;New York Times&quot; &quot;New York Times&quot; ...
##  $ media_url    : chr  &quot;http://nytimes.com&quot; &quot;http://nytimes.com&quot; &quot;http://nytimes.com&quot; &quot;http://nytimes.com&quot; ...</code></pre>
<p><strong>N.B.</strong> We can notice, without being able to explain this fact, that the number of stories downloaded (30265), which is less than what was announced by the mediacloud interface (47522). May be it is related to the elimination of duplicates ?</p>
</div>
<div id="transformation-and-storage-in-quanteda-format." class="section level3">
<h3><span class="header-section-number">3.1.2</span> Transformation and storage in quanteda format.</h3>
<p>Currently, the size of the file (unzipped) is equal to 7.3 Mb. But we can observe that a lot of information are the same for all news and should not necessarily be kept. We can also exclude the url field if we are not interested in. We propose therefore to use a better form of storage based on <code>quanteda</code> format.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-collect.html#cb3-1"></a><span class="co"># Create Quanteda corpus</span></span>
<span id="cb3-2"><a href="data-collect.html#cb3-2"></a>qd&lt;-<span class="kw">corpus</span>(df<span class="op">$</span>title)</span>
<span id="cb3-3"><a href="data-collect.html#cb3-3"></a></span>
<span id="cb3-4"><a href="data-collect.html#cb3-4"></a><span class="co"># Add date</span></span>
<span id="cb3-5"><a href="data-collect.html#cb3-5"></a>qd<span class="op">$</span>date&lt;-df<span class="op">$</span>publish_date</span>
<span id="cb3-6"><a href="data-collect.html#cb3-6"></a></span>
<span id="cb3-7"><a href="data-collect.html#cb3-7"></a><span class="co"># Add initial meta</span></span>
<span id="cb3-8"><a href="data-collect.html#cb3-8"></a><span class="kw">meta</span>(qd,<span class="st">&quot;language&quot;</span>)&lt;-df<span class="op">$</span>language[<span class="dv">1</span>]</span>
<span id="cb3-9"><a href="data-collect.html#cb3-9"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_id&quot;</span>)&lt;-df<span class="op">$</span>media_id[<span class="dv">1</span>]</span>
<span id="cb3-10"><a href="data-collect.html#cb3-10"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_name&quot;</span>)&lt;-df<span class="op">$</span>media_name[<span class="dv">1</span>]</span>
<span id="cb3-11"><a href="data-collect.html#cb3-11"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_url&quot;</span>)&lt;-df<span class="op">$</span>media_url[<span class="dv">1</span>]</span>
<span id="cb3-12"><a href="data-collect.html#cb3-12"></a></span>
<span id="cb3-13"><a href="data-collect.html#cb3-13"></a><span class="co"># Add supplementary meta</span></span>
<span id="cb3-14"><a href="data-collect.html#cb3-14"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_country&quot;</span>)&lt;-<span class="st">&quot;USA&quot;</span></span>
<span id="cb3-15"><a href="data-collect.html#cb3-15"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_source&quot;</span>)&lt;-<span class="st">&quot;Media Cloud &quot;</span></span>
<span id="cb3-16"><a href="data-collect.html#cb3-16"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_time&quot;</span>)&lt;-<span class="st">&quot;Download the 2020-07-06&quot;</span></span>
<span id="cb3-17"><a href="data-collect.html#cb3-17"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_author&quot;</span>)&lt;-<span class="st">&quot;Elaborated by Claude Grasland&quot;</span></span></code></pre></div>
<p>We have created a quanteda object with a lot of information stored in various fields. The structure of the object is the following one</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-collect.html#cb4-1"></a><span class="kw">str</span>(qd)</span></code></pre></div>
<pre><code>##  &#39;corpus&#39; Named chr [1:30265] &quot;Meteor Showers in 2020 That Will Light Up Night Skies&quot; ...
##  - attr(*, &quot;names&quot;)= chr [1:30265] &quot;text1&quot; &quot;text2&quot; &quot;text3&quot; &quot;text4&quot; ...
##  - attr(*, &quot;docvars&quot;)=&#39;data.frame&#39;:	30265 obs. of  4 variables:
##   ..$ docname_: chr [1:30265] &quot;text1&quot; &quot;text2&quot; &quot;text3&quot; &quot;text4&quot; ...
##   ..$ docid_  : Factor w/ 30265 levels &quot;text1&quot;,&quot;text2&quot;,..: 1 2 3 4 5 6 7 8 9 10 ...
##   ..$ segid_  : int [1:30265] 1 1 1 1 1 1 1 1 1 1 ...
##   ..$ date    : chr [1:30265] &quot;2020-01-01 00:00:08&quot; &quot;2020-01-01 00:05:07&quot; &quot;2020-01-01 01:00:05&quot; &quot;2020-01-01 03:00:11&quot; ...
##  - attr(*, &quot;meta&quot;)=List of 3
##   ..$ system:List of 5
##   .. ..$ package-version:Classes &#39;package_version&#39;, &#39;numeric_version&#39;  hidden list of 1
##   .. .. ..$ : int [1:3] 2 1 0
##   .. ..$ r-version      :Classes &#39;R_system_version&#39;, &#39;package_version&#39;, &#39;numeric_version&#39;  hidden list of 1
##   .. .. ..$ : int [1:3] 4 0 2
##   .. ..$ system         : Named chr [1:3] &quot;Windows&quot; &quot;x86-64&quot; &quot;CIST&quot;
##   .. .. ..- attr(*, &quot;names&quot;)= chr [1:3] &quot;sysname&quot; &quot;machine&quot; &quot;user&quot;
##   .. ..$ directory      : chr &quot;C:/claude/git/newsbook&quot;
##   .. ..$ created        : Date[1:1], format: &quot;2020-07-09&quot;
##   ..$ object:List of 2
##   .. ..$ unit   : chr &quot;documents&quot;
##   .. ..$ summary:List of 2
##   .. .. ..$ hash: chr(0) 
##   .. .. ..$ data: NULL
##   ..$ user  :List of 8
##   .. ..$ language     : chr &quot;en&quot;
##   .. ..$ media_id     : int 1
##   .. ..$ media_name   : chr &quot;New York Times&quot;
##   .. ..$ media_url    : chr &quot;http://nytimes.com&quot;
##   .. ..$ media_country: chr &quot;USA&quot;
##   .. ..$ data_source  : chr &quot;Media Cloud &quot;
##   .. ..$ data_time    : chr &quot;Download the 2020-07-06&quot;
##   .. ..$ data_author  : chr &quot;Elaborated by Claude Grasland&quot;</code></pre>
<p>We can look at the first titles with <em>head()</em></p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-collect.html#cb6-1"></a><span class="kw">kable</span>(<span class="kw">head</span>(qd,<span class="dv">3</span>))</span></code></pre></div>
<table>
<colgroup>
<col width="7%" />
<col width="92%" />
</colgroup>
<thead>
<tr class="header">
<th align="left"></th>
<th align="left">x</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">text1</td>
<td align="left">Meteor Showers in 2020 That Will Light Up Night Skies</td>
</tr>
<tr class="even">
<td align="left">text2</td>
<td align="left">Rocket Launches, Trips to Mars and More 2020 Space and Astronomy Events</td>
</tr>
<tr class="odd">
<td align="left">text3</td>
<td align="left">What’s on TV Wednesday: A Linda Ronstadt Doc and ‘Doctor Who’</td>
</tr>
</tbody>
</table>
<p>We can get meta information on each stories with <em>summary()</em></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-collect.html#cb7-1"></a><span class="kw">summary</span>(qd,<span class="dv">3</span>)</span></code></pre></div>
<pre><code>## Corpus consisting of 30265 documents, showing 3 documents:
## 
##   Text Types Tokens Sentences                date
##  text1    10     10         1 2020-01-01 00:00:08
##  text2    12     13         1 2020-01-01 00:05:07
##  text3    13     14         1 2020-01-01 01:00:05</code></pre>
<p>We can get meta information about the full document</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-collect.html#cb9-1"></a><span class="kw">meta</span>(qd)</span></code></pre></div>
<pre><code>## $language
## [1] &quot;en&quot;
## 
## $media_id
## [1] 1
## 
## $media_name
## [1] &quot;New York Times&quot;
## 
## $media_url
## [1] &quot;http://nytimes.com&quot;
## 
## $media_country
## [1] &quot;USA&quot;
## 
## $data_source
## [1] &quot;Media Cloud &quot;
## 
## $data_time
## [1] &quot;Download the 2020-07-06&quot;
## 
## $data_author
## [1] &quot;Elaborated by Claude Grasland&quot;</code></pre>
<p>We can finally save the object in RDS format</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-collect.html#cb11-1"></a><span class="kw">saveRDS</span>(qd,<span class="st">&quot;_data/qd/en_USA_nytime_20200101_20200630.RDS&quot;</span>)</span></code></pre></div>
<p>We have kept all the information present in the initial file, but also added specific metadata of interest for us. The size of the storage is now equal to 1.2Mb which means a division by 6 as compared to the initial .csv file downloaded from Media Cloud.</p>
</div>
</div>
<div id="data-level-2-title-of-news-description" class="section level2">
<h2><span class="header-section-number">3.2</span> DATA LEVEL 2 : Title of news + description</h2>
<p>We take the example of The Guardian for which we have obtained a special extraction fo title + description.</p>
<pre><code>## tibble [160,855 x 8] (S3: tbl_df/tbl/data.frame)
##  $ stories_id  : num [1:160855] 5.15e+08 6.02e+08 6.02e+08 6.02e+08 6.01e+08 ...
##  $ title       : chr [1:160855] &quot;Steve Bell’s If ... Watson-D2&#39;s booby-trap for Jez Bi-Wan Corbyn&quot; &quot;Conservative MP&#39;s aide appears in court on rape charges&quot; &quot;&#39;We&#39;re taking them home&#39;: saving Russia&#39;s brick slaves – video&quot; &quot;Saido Berahino: spiked nightclub drink was to blame for my drugs ban&quot; ...
##  $ url         : chr [1:160855] &quot;https://www.theguardian.com/commentisfree/picture/2016/sep/19/steve-bells-if-watson-d2s-booby-trap-for-jez-bi-wan-corbyn&quot; &quot;https://www.theguardian.com/uk-news/2017/mar/31/conservative-mps-aide-appears-in-court-on-charges&quot; &quot;https://www.theguardian.com/global-development/video/2017/mar/31/were-taking-them-home-saving-russia-brick-slaves-video&quot; &quot;https://www.theguardian.com/football/2017/mar/31/saido-berahino-drugs-ban-from-spiked-nightclub-drink&quot; ...
##  $ publish_date: POSIXct[1:160855], format: &quot;2016-09-19 02:15:39&quot; &quot;2017-03-31 05:46:18&quot; ...
##  $ media_id    : num [1:160855] 300560 300560 300560 300560 300560 ...
##  $ media_name  : chr [1:160855] &quot;The Guardian UK&quot; &quot;The Guardian UK&quot; &quot;The Guardian UK&quot; &quot;The Guardian UK&quot; ...
##  $ media_url   : chr [1:160855] &quot;http://www.theguardian.com/uk&quot; &quot;http://www.theguardian.com/uk&quot; &quot;http://www.theguardian.com/uk&quot; &quot;http://www.theguardian.com/uk&quot; ...
##  $ description : chr [1:160855] &quot;&lt;a href=\&quot;https://www.theguardian.com/commentisfree/picture/2016/sep/19/steve-bells-if-watson-d2s-booby-trap-fo&quot;| __truncated__ &quot;&lt;p&gt;Sam Armstrong, who has been suspended as Craig Mackinlay’s chief of staff, allegedly raped a woman in the Ho&quot;| __truncated__ &quot;&lt;p&gt;Thousands of Russia’s most vulnerable men and women go missing every year. They are plucked from cities and &quot;| __truncated__ &quot;• Former West Brom striker served eight-week ban for taking recreational drug&lt;br /&gt;• Berahino: ‘I still cannot &quot;| __truncated__ ...</code></pre>
<p>We can recognize many variables from our first example of download of title from Mediacloud. But with a new field called description that add more or less text, depending of the media under investigation.</p>
<div id="cleaning-the-html-code-in-description-file" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Cleaning the html code in description file</h3>
<p>We have generally a high risk to find html codes in the description field which are not of prior interest for textual analysis. The problem is clearly present in our example :</p>
<pre><code>## [1] &quot;&lt;a href=\&quot;https://www.theguardian.com/commentisfree/picture/2016/sep/19/steve-bells-if-watson-d2s-booby-trap-for-jez-bi-wan-corbyn\&quot;&gt;Continue reading...&lt;/a&gt;&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                         
## [2] &quot;&lt;p&gt;Sam Armstrong, who has been suspended as Craig Mackinlay’s chief of staff, allegedly raped a woman in the Houses of Parliament&lt;/p&gt;&lt;p&gt;A Tory MP’s aide has appeared in court accused of raping a woman in the Houses of Parliament.&lt;/p&gt;&lt;p&gt;Sam Armstrong, who has been suspended as chief of staff to South Thanet MP Craig Mackinlay, appeared at Westminster magistrates court on Friday charged with two counts of rape and one count of sexual assault by penetration.&lt;/p&gt; &lt;a href=\&quot;https://www.theguardian.com/uk-news/2017/mar/31/conservative-mps-aide-appears-in-court-on-charges\&quot;&gt;Continue reading...&lt;/a&gt;&quot;</code></pre>
<pre><code>## [1] &quot;&lt;p&gt;The man who came up with the classic I love NY logo died on Friday at 91, leaving a rich legacy&lt;/p&gt;&lt;p&gt;It’s a privilege and occasional frustration for graphic designers that they furnish the backgrounds of the lives of millions, without those millions always being aware that they have done so. So it was for Milton Glaser, who died on Friday, on his 91st birthday.&lt;/p&gt;&lt;p&gt;It is hard to think of any visual artist so pervasive in his influence. If you’re of a certain age, you might have noticed his carnivalesque covers on the Signet Classic &lt;a href=\&quot;https://www.miltonglaser.com/the-work/123/signet-signet-classics/\&quot;&gt;paperback series of Shakespeare plays&lt;/a&gt;, or have owned the poster he made for Bob Dylan’s &lt;em&gt;Greatest Hits&lt;/em&gt;, in which bright riotous hair bursts from the singer’s austere silhouette. With the Push Pin Studios, which he helped found in 1954 with fellow graduates of the Cooper Union design school, he can be said to have created what became the look of the 60s: flowing lines, rainbow colours, strong patterns.&lt;/p&gt; &lt;a href=\&quot;https://www.theguardian.com/artanddesign/2020/jun/27/milton-glaser-why-the-new-york-graphic-designer-was-so-influential\&quot;&gt;Continue reading...&lt;/a&gt;&quot;                                                                                                                                                                                                                                                                                
## [2] &quot;&lt;p&gt;Texas pauses next phase of reopening; Mexico treasury secretary tests positive for Covid-19; Brazil registers 39,483 new cases; Follow the latest updates&lt;/p&gt;&lt;ul&gt;&lt;li&gt;&lt;a href=\&quot;https://www.theguardian.com/world/2020/jun/25/major-incident-declared-as-people-flock-to-england-south-coast\&quot;&gt;England: major incident declared as people flock to south coast&lt;/a&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;https://www.theguardian.com/us-news/2020/jun/25/trump-fauci-redfield-cdc-coronavirus-messages\&quot;&gt;How Trump and his officials diverge on coronavirus&lt;/a&gt;&lt;br /&gt;&lt;/li&gt;&lt;li&gt;&lt;a href=\&quot;https://www.theguardian.com/world/coronavirus-outbreak\&quot;&gt;See all our coronavirus coverage&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;p class=\&quot;block-time published-time\&quot;&gt; &lt;time datetime=\&quot;2020-06-25T23:32:30.877Z\&quot;&gt;12.32am &lt;span class=\&quot;timezone\&quot;&gt;BST&lt;/span&gt;&lt;/time&gt; &lt;/p&gt;&lt;p&gt;Hello and welcome to today’s live coverage of the coronavirus pandemic. &lt;/p&gt;&lt;p&gt;I’m &lt;a href=\&quot;https://twitter.com/helenrsullivan\&quot;&gt;Helen Sullivan&lt;/a&gt; and I’ll be bringing you the latest developments from around the world for the next few hours. You’re welcome to send news and tips from your part of the world, comments, questions or suggestions to me on Twitter &lt;a href=\&quot;https://twitter.com/helenrsullivan\&quot;&gt;@helenrsullivan&lt;/a&gt; or via email: helen.sullivan@theguardian.com. &lt;/p&gt; &lt;a href=\&quot;https://www.theguardian.com/world/live/2020/jun/26/coronavirus-live-news-cases-rise-in-27-us-states-as-cdc-estimates-20m-americans-may-have-been-infected\&quot;&gt;Continue reading...&lt;/a&gt;&quot;</code></pre>
<p>Therefore, we can proceed to an immediate cleaning through a function. One of the most simple one is proposed below, but can be further completed for specific situation</p>
<pre><code>## [1] &quot;Continue reading...&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                           
## [2] &quot;Sam Armstrong, who has been suspended as Craig Mackinlay’s chief of staff, allegedly raped a woman in the Houses of ParliamentA Tory MP’s aide has appeared in court accused of raping a woman in the Houses of Parliament.Sam Armstrong, who has been suspended as chief of staff to South Thanet MP Craig Mackinlay, appeared at Westminster magistrates court on Friday charged with two counts of rape and one count of sexual assault by penetration. Continue reading...&quot;</code></pre>
<pre><code>## [1] &quot;The man who came up with the classic I love NY logo died on Friday at 91, leaving a rich legacyIt’s a privilege and occasional frustration for graphic designers that they furnish the backgrounds of the lives of millions, without those millions always being aware that they have done so. So it was for Milton Glaser, who died on Friday, on his 91st birthday.It is hard to think of any visual artist so pervasive in his influence. If you’re of a certain age, you might have noticed his carnivalesque covers on the Signet Classic paperback series of Shakespeare plays, or have owned the poster he made for Bob Dylan’s Greatest Hits, in which bright riotous hair bursts from the singer’s austere silhouette. With the Push Pin Studios, which he helped found in 1954 with fellow graduates of the Cooper Union design school, he can be said to have created what became the look of the 60s: flowing lines, rainbow colours, strong patterns. Continue reading...&quot;
## [2] &quot;Texas pauses next phase of reopening; Mexico treasury secretary tests positive for Covid-19; Brazil registers 39,483 new cases; Follow the latest updatesEngland: major incident declared as people flock to south coastHow Trump and his officials diverge on coronavirusSee all our coronavirus coverage 12.32am BST Hello and welcome to today’s live coverage of the coronavirus pandemic. I’m Helen Sullivan and I’ll be bringing you the latest developments from around the world for the next few hours. You’re welcome to send news and tips from your part of the world, comments, questions or suggestions to me on Twitter @helenrsullivan or via email: helen.sullivan@theguardian.com.  Continue reading...&quot;</code></pre>
<p>In our example, we can see that the description is related to a number of sentences followed by <em>Continue reading</em>. It can therefore be relevant to eliminate immediately the final part But the cleaning procedure is generally much longer and complex, especially when the corpus cover many years. Indeed, the style of description may have change through time. This point will be discuss in more details in the next chapter.</p>
</div>
<div id="transformation-of-textdescription-in-quanteda-corpus" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Transformation of text+description in quanteda corpus</h3>
<p>As we have done previously, we will store the result in a quanteda corpus object with associated metadata. But before to do that we have to merge title + description in a same text where title will be the first sentence.</p>
<p>N.B. I am not quite sure of the good separator to be used between title and description</p>
<pre><code>## [1] &quot;Steve Bell’s If ... Watson-D2&#39;s booby-trap for Jez Bi-Wan Corbyn.\n.Continue reading...&quot;                                                                                                                                                                                                                                                                                                                                                                                                                                                  
## [2] &quot;Conservative MP&#39;s aide appears in court on rape charges.\n.Sam Armstrong, who has been suspended as Craig Mackinlay’s chief of staff, allegedly raped a woman in the Houses of ParliamentA Tory MP’s aide has appeared in court accused of raping a woman in the Houses of Parliament.Sam Armstrong, who has been suspended as chief of staff to South Thanet MP Craig Mackinlay, appeared at Westminster magistrates court on Friday charged with two counts of rape and one count of sexual assault by penetration. Continue reading...&quot;</code></pre>
<pre><code>## [1] &quot;Milton Glaser graphic designer dies aged 91 i love ny logo.\n.The man who came up with the classic I love NY logo died on Friday at 91, leaving a rich legacyIt’s a privilege and occasional frustration for graphic designers that they furnish the backgrounds of the lives of millions, without those millions always being aware that they have done so. So it was for Milton Glaser, who died on Friday, on his 91st birthday.It is hard to think of any visual artist so pervasive in his influence. If you’re of a certain age, you might have noticed his carnivalesque covers on the Signet Classic paperback series of Shakespeare plays, or have owned the poster he made for Bob Dylan’s Greatest Hits, in which bright riotous hair bursts from the singer’s austere silhouette. With the Push Pin Studios, which he helped found in 1954 with fellow graduates of the Cooper Union design school, he can be said to have created what became the look of the 60s: flowing lines, rainbow colours, strong patterns. Continue reading...&quot;
## [2] &quot;Coronavirus live news: cases rise in 27 US states as CDC estimates 20m Americans may have been infected.\n.Texas pauses next phase of reopening; Mexico treasury secretary tests positive for Covid-19; Brazil registers 39,483 new cases; Follow the latest updatesEngland: major incident declared as people flock to south coastHow Trump and his officials diverge on coronavirusSee all our coronavirus coverage 12.32am BST Hello and welcome to today’s live coverage of the coronavirus pandemic. I’m Helen Sullivan and I’ll be bringing you the latest developments from around the world for the next few hours. You’re welcome to send news and tips from your part of the world, comments, questions or suggestions to me on Twitter @helenrsullivan or via email: helen.sullivan@theguardian.com.  Continue reading...&quot;</code></pre>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-collect.html#cb19-1"></a><span class="co"># Create Quanteda corpus</span></span>
<span id="cb19-2"><a href="data-collect.html#cb19-2"></a>qd&lt;-<span class="kw">corpus</span>(df<span class="op">$</span>text)</span>
<span id="cb19-3"><a href="data-collect.html#cb19-3"></a></span>
<span id="cb19-4"><a href="data-collect.html#cb19-4"></a><span class="co"># Add date</span></span>
<span id="cb19-5"><a href="data-collect.html#cb19-5"></a>qd<span class="op">$</span>date&lt;-<span class="kw">as.POSIXct</span>(<span class="kw">strptime</span>(df<span class="op">$</span>publish_date,<span class="st">&quot;%Y-%m-%d %H:%M:%S&quot;</span>))</span>
<span id="cb19-6"><a href="data-collect.html#cb19-6"></a></span>
<span id="cb19-7"><a href="data-collect.html#cb19-7"></a><span class="co"># Add initial meta</span></span>
<span id="cb19-8"><a href="data-collect.html#cb19-8"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_id&quot;</span>)&lt;-df<span class="op">$</span>media_id[<span class="dv">1</span>]</span>
<span id="cb19-9"><a href="data-collect.html#cb19-9"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_name&quot;</span>)&lt;-df<span class="op">$</span>media_name[<span class="dv">1</span>]</span>
<span id="cb19-10"><a href="data-collect.html#cb19-10"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_url&quot;</span>)&lt;-df<span class="op">$</span>media_url[<span class="dv">1</span>]</span>
<span id="cb19-11"><a href="data-collect.html#cb19-11"></a></span>
<span id="cb19-12"><a href="data-collect.html#cb19-12"></a><span class="co"># Add supplementary meta</span></span>
<span id="cb19-13"><a href="data-collect.html#cb19-13"></a><span class="kw">meta</span>(qd,<span class="st">&quot;language&quot;</span>)&lt;-<span class="st">&quot;en&quot;</span></span>
<span id="cb19-14"><a href="data-collect.html#cb19-14"></a><span class="kw">meta</span>(qd,<span class="st">&quot;media_country&quot;</span>)&lt;-<span class="st">&quot;FRA&quot;</span></span>
<span id="cb19-15"><a href="data-collect.html#cb19-15"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_source&quot;</span>)&lt;-<span class="st">&quot;Media Cloud &quot;</span></span>
<span id="cb19-16"><a href="data-collect.html#cb19-16"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_time&quot;</span>)&lt;-<span class="st">&quot;Special extraction&quot;</span></span>
<span id="cb19-17"><a href="data-collect.html#cb19-17"></a><span class="kw">meta</span>(qd,<span class="st">&quot;data_author&quot;</span>)&lt;-<span class="st">&quot;Elaborated by Claude Grasland&quot;</span></span>
<span id="cb19-18"><a href="data-collect.html#cb19-18"></a></span>
<span id="cb19-19"><a href="data-collect.html#cb19-19"></a><span class="co"># Save in Rdata format</span></span>
<span id="cb19-20"><a href="data-collect.html#cb19-20"></a><span class="kw">saveRDS</span>(qd,<span class="dt">file =</span><span class="st">&quot;_data/qd/en_GBR_guardi.Rdata&quot;</span>)</span></code></pre></div>
</div>
</div>
<div id="data-level-3-full-text" class="section level2">
<h2><span class="header-section-number">3.3</span> DATA LEVEL 3 : Full text</h2>
<p>We consider finally the case of news based on full text. It is generally related to the selection of a precise corpus related to a specific topic (e.g. migration, border, …) in order to limit the size of the resulting database.</p>
<p>We can take the example of …</p>
<p><em>To be done.</em></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="intro.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="data-check.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/ClaudeGrasland/newsbook/edit/master/02-data-collection.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["newsbook.pdf", "newsbook.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
